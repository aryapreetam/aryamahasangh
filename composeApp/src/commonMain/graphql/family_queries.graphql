# GraphQL Fragments for Family Management

# Family Fields Fragment
fragment FamilyFields on Family {
  id
  name
  photos
  address {
    id
    basicAddress
    state
    district
    pincode
    latitude
    longitude
    vidhansabha
    createdAt
  }
  aryaSamaj {
    id
    name
    address {
      basicAddress
      district
      state
    }
  }
  familyMemberCollection(
    orderBy: [{ isHead: DescNullsLast }, { createdAt: AscNullsFirst }]
  ) {
    edges {
      node {
        id
        isHead
        relationToHead
        createdAt
        member {
          ...MemberDetails
        }
      }
    }
  }
  createdAt
}

# Member Details Fragment (includes DOB and address info)
fragment MemberDetails on Member {
  id
  name
  profileImage
  phoneNumber
  joiningDate
  email
  dob
  address {
    id
    basicAddress
    state
    district
    pincode
    latitude
    longitude
    vidhansabha
  }
  tempAddress {
    id
    basicAddress
    state
    district
    pincode
    latitude
    longitude
    vidhansabha
  }
  educationalQualification
}

# Family Queries

# Get all families with basic information
query GetFamilies(
  $first: Int
  $after: Cursor
  $filter: FamilyFilter
  $orderBy: [FamilyOrderBy!]
) {
  familyCollection(
    first: $first
    after: $after
    filter: $filter
    orderBy: $orderBy
  ) {
    edges {
      node {
        ...FamilyFields
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

# Get detailed family information with all members
query GetFamilyDetail($familyId: String!) {
  familyCollection(filter: { id: { eq: $familyId } }) {
    edges {
      node {
        ...FamilyFields
      }
    }
  }
}

# Get families by Arya Samaj
query GetFamiliesByAryaSamaj(
  $aryaSamajId: String!
  $first: Int
  $after: Cursor
) {
  familyCollection(
    filter: { aryaSamajId: { eq: $aryaSamajId } }
    first: $first
    after: $after
    orderBy: [{ name: AscNullsFirst }]
  ) {
    edges {
      node {
        ...FamilyFields
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

# Get families by address/location using addressId
query GetFamiliesByLocation(
  $state: String
  $district: String
  $first: Int
) {
  addressCollection(
    filter: {
      and: [
        { state: { eq: $state } }
        { district: { eq: $district } }
      ]
    }
  ) {
    edges {
      node {
        id
        basicAddress
        state
        district
        pincode
        familyCollection(
          first: $first
          orderBy: [{ name: AscNullsFirst }]
        ) {
          edges {
            node {
              ...FamilyFields
            }
          }
        }
      }
    }
  }
}

# Search families by name
query SearchFamilies($searchTerm: String!, $first: Int, $after: Cursor) {
  familyCollection(
    filter: { name: { ilike: $searchTerm } }
    first: $first
    after: $after
    orderBy: [{ createdAt: DescNullsLast }]
  ) {
    edges {
      node {
        ...FamilyFields
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

fragment MemberWithoutFamily on MemberNotInFamily {
  id
  name
  phoneNumber
  profileImage
  addressId
}

# Get members without family (for family creation)
query GetMembersWithoutFamily(
  $searchTerm: String
  $first: Int
) {
  memberNotInFamilyCollection(
    filter: {
      or: [
        { name: { ilike: $searchTerm } }
        { phoneNumber: { ilike: $searchTerm } }
      ]
    }
    first: $first
    orderBy: [{ name: AscNullsFirst }]
  ) {
    edges {
      node {
        ...MemberWithoutFamily
      }
    }
  }
}

# Get all family member IDs to filter out members who are already in families
query GetAllFamilyMemberIds {
  familyMemberCollection {
    edges {
      node {
        memberId
      }
    }
  }
}

# Count queries
# Get total count of families
query GetFamiliesCount {
  familyCollection {
    totalCount
  }
}

# Get total count of family members
query GetFamilyMembersCount {
  familyMemberCollection {
    totalCount
  }
}

query GetTotalFamilyAndFamilyMemberCount {
  familyCollection {
    totalCount
  }
  familyMemberCollection {
    totalCount
  }
}
