fragment MemberShort on Member {
  id
  name
  profileImage
}

fragment MemberInOrganisationShort on MemberInOrganisation {
  id
  name
  profileImage
}

query members {
  memberCollection {
    edges {
      node {
        ...MemberShort
      }
    }
  }
}

query membersInOrganisation {
  memberInOrganisationCollection {
    edges {
      node {
        ...MemberInOrganisationShort
      }
    }
  }
}

query organisationalMembers {
  memberInOrganisationCollection {
    edges {
      node {
        ...MemberInOrganisationShort
      }
    }
  }
}

query searchMembers($nameOrPhoneNumber: String!) {
  memberCollection(
    filter: {
      or: [
        {name: {ilike: $nameOrPhoneNumber}},
        {phoneNumber: {ilike: $nameOrPhoneNumber}}
      ]
    }
  ) {
    edges {
      node {
        ...MemberShort
      }
    }
  }
}

query searchOrganisationalMembers($nameOrPhoneNumber: String!) {
  memberInOrganisationCollection(
    filter: {
      or: [
        {name: {ilike: $nameOrPhoneNumber}},
        {phoneNumber: {ilike: $nameOrPhoneNumber}}
      ]
    }
  ) {
    edges {
      node {
        ...MemberInOrganisationShort
      }
    }
  }
}

query membersCount {
  memberCollection {
    totalCount
  }
}

query memberDetail($memberId: String!) {
  memberCollection(filter: {id: {eq: $memberId}}) {
    edges {
      node {
        id
        name
        profileImage
        phoneNumber
        educationalQualification
        email
        dob
        joiningDate
        gender
        introduction
        occupation
        referrerId
        address {
          ...AddressFields
        }
        tempAddress {
          ...AddressFields
        }
        aryaSamaj {
          ...AryaSamajFields
        }
        referrer {
           id
          name
          profileImage
        }
        organisationalMemberCollection {
          edges {
            node {
              id
              post
              priority
              organisation {
                id
                name
                logo
              }
            }
          }
        }
        activityMemberCollection {
          edges {
            node {
              activity {
                id
                name
                district
                state
                startDatetime
                endDatetime
              }
            }
          }
        }
        samajMemberCollection {
          edges {
            node {
              id
              post
              priority
              aryaSamaj {
                id
                name
                description
              }
            }
          }
        }
      }
    }
  }
}

query Organisations {
  organisationCollection(orderBy: {priority: AscNullsLast}) {
    edges {
      node {
        id
        name
        description
      }
    }
  }
}

query OrganisationNames {
  organisationCollection(orderBy: {priority: AscNullsLast}) {
    edges {
      node {
        id
        name
      }
    }
  }
}

query OrganisationsAndMembers {
  memberCollection {
    edges {
      node {
        ...MemberShort
      }
    }
  }
  organisationCollection {
    edges {
      node {
        id
        name
      }
    }
  }
}

query OrganisationDetailById($orgnisationId: String!) {
  organisationCollection(filter: { id: { eq: $orgnisationId } }) {
    edges {
      node {
        id
        name
        logo
        description
        organisationalMemberCollection {
          edges {
            node {
              id
              post
              priority
              member {
                id
                name
                email
                phoneNumber
                profileImage
                educationalQualification
              }
            }
          }
        }
      }
    }
  }
}

query Organisation($filter: OrganisationFilter) {
  organisationCollection(filter: $filter) {
    edges {
      node {
        id
        name
        logo
        description
        organisationalMemberCollection {
          edges {
            node {
              id
              post
              priority
              member {
                id
                name
                email
                phoneNumber
                profileImage
                educationalQualification
              }
            }
          }
        }
      }
    }
  }
}

query LearningItems {
  learningCollection {
    edges {
      node {
        id
        thumbnailUrl
        title
      }
    }
  }
}

query LearningItem($filter: LearningFilter) {
  learningCollection(filter: $filter) {
    edges {
      node {
        id
        thumbnailUrl
        title
        videoId
        url
        description
      }
    }
  }
}

fragment OrganisationalActivityShort on Activities {
  id
  name
  shortDescription
  startDatetime
  endDatetime
  type
  district
  state
}

query UpcomingSatrByRegion($state: String!, $district: String, $currentDateTime: Datetime) {
  activitiesCollection(
    filter: {
      state: {eq: $state},
      district: {eq: $district},
      startDatetime: {gt: $currentDateTime},
      type: {eq: SESSION}
    }
  ) {
    edges {
      node {
        ...OrganisationalActivityShort
      }
    }
  }
}

query OrganisationalActivities($filter: ActivitiesFilter) {
  activitiesCollection(filter: $filter) {
    edges {
      node {
        ...OrganisationalActivityShort
      }
    }
  }
}

query OrganisationalActivityDetailById($activityId: String!) {
  activitiesCollection(filter: { id: { eq: $activityId } }) {
    edges {
      node {
        ...OrganisationalActivityShort
        longDescription
        address
        state
        mediaFiles
        additionalInstructions
        capacity
        latitude
        longitude
        allowedGender
        overviewDescription
        overviewMediaUrls
        organisationalActivityCollection {
          edges {
            node {
              id
              organisation {
                id
                name
              }
            }
          }
        }
        activityMemberCollection {
          edges {
            node {
              id
              post
              priority
              member {
                id
                name
                profileImage
                phoneNumber
              }
            }
          }
        }
      }
    }
  }
}

query OrganisationalActivityDetail($filter: ActivitiesFilter) {
  activitiesCollection(filter: $filter) {
    edges {
      node {
        ...OrganisationalActivityShort
        longDescription
        address
        state
        mediaFiles
        additionalInstructions
        capacity
        latitude
        longitude
        allowedGender
        overviewDescription
        overviewMediaUrls
        organisationalActivityCollection {
          edges {
            node {
              id
              organisation {
                id
                name
              }
            }
          }
        }
        activityMemberCollection {
          edges {
            node {
              id
              post
              priority
              member {
                id
                name
                profileImage
                phoneNumber
              }
            }
          }
        }
      }
    }
  }
}

query StudentsApplied {
  admissionCollection {
    edges {
      node {
        id
        studentName
        studentPhoto
        previousClass
        marksObtained
      }
    }
  }
}

query AppLabel($labelKey: String!) {
  appLabelsCollection(filter: { labelKey: { eq: $labelKey } }) {
    edges {
      node {
        id
        labelValue
      }
    }
  }
}

query BookOrders($filter: BookOrdersFilter) {
  bookOrdersCollection(filter: $filter) {
    edges {
      node {
        id
        fullname
        address
        city
        district
        state
        pincode
        country
        mobile
        districtOfficerName
        districtOfficerNumber
        paymentReceiptUrl
        createdAt
        isFulfilled
      }
    }
  }
}

query UpcomingSatrActivities($currentDateTime: Datetime!) {
  activitiesCollection(
    filter: {
      startDatetime: {gt: $currentDateTime},
      type: {eq: SESSION}
    }
  ) {
    edges {
      node {
        id
        name
        startDatetime
        endDatetime
        allowedGender
        district
        state
        latitude
        longitude
        capacity
        satrRegistrationCollection {
          pageInfo {
            startCursor
          }
          edges {
            node {
              id
            }
          }
        }
      }
    }
  }
}

query registrationsForActivity($activityId: String!) {
  satrRegistrationCollection(filter: { activityId: { eq: $activityId } }) {
    edges {
      node {
        id
        fullname
        gender
        address
        mobile
      }
    }
  }
}

# Address Queries
fragment AddressFields on Address {
  id
  basicAddress
  state
  district
  pincode
  latitude
  longitude
  vidhansabha
  createdAt
}

query addresses($filter: AddressFilter) {
  addressCollection(filter: $filter) {
    edges {
      node {
        ...AddressFields
      }
    }
  }
}

query addressDetail($addressId: String!) {
  addressCollection(filter: {id: {eq: $addressId}}) {
    edges {
      node {
        ...AddressFields
        memberCollection {
          edges {
            node {
              id
              name
              profileImage
              phoneNumber
            }
          }
        }
        memberWithTempAddressCollection {
          edges {
            node {
              id
              name
              profileImage
              phoneNumber
            }
          }
        }
        aryaSamajCollection {
          edges {
            node {
              id
              name
              description
            }
          }
        }
      }
    }
  }
}

query addressesByLocation($state: String!, $district: String) {
  addressCollection(
    filter: {
      and: [
        {state: {eq: $state}},
        {district: {eq: $district}}
      ]
    }
  ) {
    edges {
      node {
        ...AddressFields
      }
    }
  }
}

# Arya Samaj Queries
fragment AryaSamajFields on AryaSamaj {
  id
  name
  description
  mediaUrls
  addressId
  address {
    ...AddressFields
  }
  createdAt
}

fragment AryaSamajWithAddress on AryaSamaj {
  ...AryaSamajFields
  address {
    ...AddressFields
  }
}

query aryaSamajs($filter: AryaSamajFilter) {
  aryaSamajCollection(filter: $filter) {
    edges {
      node {
        ...AryaSamajFields
        address {
          ...AddressFields
        }
      }
    }
  }
}

query aryaSamajDetail($aryaSamajId: String!) {
  aryaSamajCollection(filter: {id: {eq: $aryaSamajId}}) {
    edges {
      node {
        ...AryaSamajFields
        address {
          ...AddressFields
        }
        samajMemberCollection {
          edges {
            node {
              id
              post
              priority
              member {
                id
                name
                profileImage
                phoneNumber
                educationalQualification
              }
            }
          }
        }
        memberCollection {
          edges {
            node {
              id
              name
              profileImage
              phoneNumber
              educationalQualification
            }
          }
        }
      }
    }
  }
}

query aryaSamajCount {
  aryaSamajCollection {
    totalCount
  }
}

query getAryaSamajs($first: Int!, $after: Cursor, $filter: AryaSamajFilter, $orderBy: [AryaSamajOrderBy!]) {
  aryaSamajCollection(
    first: $first
    after: $after
    filter: $filter
    orderBy: $orderBy
  ) {
    edges {
      node {
        ...AryaSamajWithAddress
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

query searchAryaSamajs($first: Int!, $after: Cursor, $searchTerm: String!) {
  aryaSamajCollection(
    first: $first
    after: $after
    filter: {
      name: {ilike: $searchTerm}
    }
    orderBy: {createdAt: DescNullsLast}
  ) {
    edges {
      node {
        ...AryaSamajWithAddress
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

# Samaj Member Queries
fragment SamajMemberFields on SamajMember {
  id
  post
  priority
  createdAt
}

query samajMembers($filter: SamajMemberFilter) {
  samajMemberCollection(filter: $filter) {
    edges {
      node {
        ...SamajMemberFields
        member {
          id
          name
          profileImage
          phoneNumber
          educationalQualification
        }
        aryaSamaj {
          id
          name
          description
        }
      }
    }
  }
}

query samajMembersByAryaSamaj($aryaSamajId: String!) {
  samajMemberCollection(filter: {aryaSamajId: {eq: $aryaSamajId}}) {
    edges {
      node {
        ...SamajMemberFields
        member {
          id
          name
          profileImage
          phoneNumber
          educationalQualification
        }
      }
    }
  }
}

query samajMembersByMember($memberId: String!) {
  samajMemberCollection(filter: {memberId: {eq: $memberId}}) {
    edges {
      node {
        ...SamajMemberFields
        aryaSamaj {
          id
          name
          description
          address {
            basicAddress
            state
            district
          }
        }
      }
    }
  }
}

# Enhanced Member Queries with Address
query memberWithAddress($memberId: String!) {
  memberCollection(filter: {id: {eq: $memberId}}) {
    edges {
      node {
        id
        name
        profileImage
        phoneNumber
        educationalQualification
        email
        dob
        joiningDate
        gender
        introduction
        occupation
        referrerId
        address {
          ...AddressFields
        }
        tempAddress {
          ...AddressFields
        }
        aryaSamaj {
          ...AryaSamajFields
        }
        organisationalMemberCollection {
          edges {
            node {
              id
              post
              priority
              organisation {
                id
                name
                logo
              }
            }
          }
        }
        samajMemberCollection {
          edges {
            node {
              id
              post
              priority
              aryaSamaj {
                id
                name
                description
              }
            }
          }
        }
      }
    }
  }
}

# Member Not In Family Queries
fragment MemberNotInFamilyShort on MemberNotInFamily {
  id
  name
  profileImage
  phoneNumber
  addressId
}

query ekalAryaMembers($first: Int!, $after: Cursor) {
  memberNotInFamilyCollection(
    first: $first
    after: $after
    orderBy: {name: AscNullsLast}
  ) {
    edges {
      node {
        ...MemberNotInFamilyShort
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

query searchEkalAryaMembers($first: Int!, $after: Cursor, $searchTerm: String!) {
  memberNotInFamilyCollection(
    first: $first
    after: $after
    filter: {
      or: [
        {name: {ilike: $searchTerm}},
        {phoneNumber: {ilike: $searchTerm}}
      ]
    }
    orderBy: {name: AscNullsLast}
  ) {
    edges {
      node {
        ...MemberNotInFamilyShort
      }
      cursor
    }
    pageInfo {
      hasNextPage
      hasPreviousPage
      startCursor
      endCursor
    }
  }
}

# Legacy query - keeping for backward compatibility
query searchEkalAryaMembersLegacy($nameOrPhoneNumber: String!) {
  memberNotInFamilyCollection(
    filter: {
      or: [
        {name: {ilike: $nameOrPhoneNumber}},
        {phoneNumber: {ilike: $nameOrPhoneNumber}}
      ]
    }
  ) {
    edges {
      node {
        ...MemberNotInFamilyShort
      }
    }
  }
}

# Separate query for referrer details
query memberReferrer($referrerId: String!) {
  memberCollection(filter: {id: {eq: $referrerId}}) {
    edges {
      node {
        id
        name
        profileImage
      }
    }
  }
}

query CountsForAdminContainer{
  memberInOrganisationCollection{
    totalCount
  }
  aryaSamajCollection{
    totalCount
  }
  familyCollection{
    totalCount
  }
  memberNotInFamilyCollection{
    totalCount
  }
}
